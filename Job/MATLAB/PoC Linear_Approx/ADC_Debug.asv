% Using zero crossinger trigger
%voltage = [2714, 0, 1660, 0, 1640, 0, 1660, 0, 1679, 0, 1655, 0, 1674, 0, 1650, 0, 1669, 0, 1645, 0, 1665, 0, 1547, 0, 1660, 0, 1635, 0, 1655, 0, 1674, 0, 1650, 0, 1669, 0, 1650, 0, 1669, 0, 1645, 0, 1660, 0, 1640, 0, 1660, 0, 1635, 0, 1655, 0, 1674, 0, 1645, 0, 1669, 0, 1650, 0, 1665, 0, 1645, 0, 1665, 0, 1640, 0, 1655, 0, 1630, 0, 1650, 0, 1669, 0, 1645, 0, 1665]
%current = [0, 2436, 0, 2768, 0, 2749, 0, 2763, 0, 2778, 0, 2763, 0, 2778, 0, 2763, 0, 2773, 0, 2758, 0, 2773, 0, 2753, 0, 2768, 0, 2749, 0, 2768, 0, 2778, 0, 2983, 0, 2773, 0, 2988, 0, 2773, 0, 2988, 0, 2768, 0, 2988, 0, 2763, 0, 2983, 0, 2763, 0, 2973, 0, 2763, 0, 2963, 0, 2758, 0, 2949, 0, 2758, 0, 2934, 0, 2749, 0, 2915, 0, 2744, 0, 2895, 0, 2773, 0, 2866, 0];

% Free running interrupt]
%voltage = [2548, 0, 2949, 0, 2534, 0, 2905, 8, 1240, 0, 2275, 0, 2988, 0, 2299, 0, 1254, 0, 2514, 0, 2963, 0, 2060, 0, 1157, 0, 1606, 0, 2719, 0, 2861, 0, 1806, 0, 1835, 0, 2875, 0, 2695, 0, 1577, 0, 1171, 0, 2089, 0, 2973, 0, 2490, 0, 1376, 0, 1743, 0, 2988, 0, 2250, 0, 1230, 0, 1445, 0, 2568, 0, 2939, 0, 1997, 0, 1230, 0, 2763, 0, 2827, 0, 1748, 0, 1132, 0, 1894, 0, ]
%current = [0, 2812, 0, 2919, 0, 1953, 0, 1132, 0, 1684, 0, 2778, 0, 2797, 0, 1708, 0, 1928, 0, 2919, 0, 2622, 0, 1499, 0, 1206, 0, 2187, 0, 2988, 0, 2402, 0, 1313, 0, 2431, 0, 2978, 0, 2158, 0, 1191, 0, 1523, 0, 2646, 0, 2905, 0, 1904, 0, 1279, 0, 2822, 0, 2763, 0, 1660, 0, 1147, 0, 1992, 0, 2944, 0, 2578, 0, 1445, 0, 1655, 0, 2993, 0, 2348, 0, 1279, 0, 1372, 0, 2485]

% Free running, interurpt more often
%voltage = [2431, 0, 2846, 0, 2646, 0, 1606, 0, 1259, 0, 2128, 0, 2924, 0, 2456, 0, 1430, 0, 2358, 0, 2949, 0, 2241, 0, 1308, 0, 1528, 0, 2573, 0, 2895, 0, 2001, 0, 1728, 0, 2749, 0, 2783, 0, 1777, 0, 1225, 0, 1953, 0, 2875, 0, 2622, 0, 1567, 0, 1640, 0, 2939, 0, 2416, 0, 1401, 0, 1396, 0, 2412, 0, 2939, 0, 2192, 0, 1254, 0, 2617, 0, 2875, 0, 1958, 0, 1225, 0, 1772, 0, ];
%current = [0, 2783, 0, 2924, 0, 2138, 0, 1264, 0, 1601, 0, 2641, 0, 2846, 0, 1909, 0, 1806, 0, 2802, 0, 2724, 0, 1694, 0, 1240, 0, 2041, 0, 2910, 0, 2543, 0, 1499, 0, 2275, 0, 2949, 0, 2333, 0, 1347, 0, 1464, 0, 2495, 0, 2924, 0, 2099, 0, 1284, 0, 2685, 0, 2832, 0, 1865, 0, 1220, 0, 1855, 0, 2827, 0, 2690, 0, 1650, 0, 1567, 0, 2919, 0, 2500, 0, 1469, 0, 1342, 0, 2324, ];


% Free running, interrumpt more often, no zeros
%voltage = [2221, 1767, 1274, 1982, 2846, 2573, 1577, 1333, 2207, 2377, 1416, 1450, 2421, 2895, 2163, 1308, 1611, 2827, 1938, 1264, 1811, 2763, 2700, 1723, 1279, 2031, 2534, 1533, 1352, 2260, 2905, 2324, 1386, 1484, 2885, 2109, 1298, 1655, 2651, 2802];
%current = [1713, 1372, 1508, 2504, 1542, 1313, 2709, 2539, 1606, 2832, 2246, 2607, 2812, 2641, 1645, 1298, 2119, 2460, 1474, 1396, 2343, 2905, 2241, 1347, 1542, 2856, 2021, 1279, 1733, 2709, 2753, 1801, 1264, 1948, 2602, 1601, 1318, 2167, 2900, 2407];

%Free running, interupt more often, zeros
%voltage = [2778, 0, 2485, 0, 1489, 0, 1333, 0, 2255, 0, 2885, 0, 2280, 0, 1347, 0, 1469, 0, 2861, 0, 2060, 0, 1254, 0, 1650, 0, 2646, 0, 2768, 0, 1835, 0, 1230, 0, 1582, 0, 1284, 0, 2875, 0, 2402, 0, 1416, 0, 1386, 0, 2353, 0, 2880, 0, 2187, 0, 1298, 0, 2041, 0, 1639, 11, 1958, 0, 1240, 0, 1738, 0, 2714, 0, 2714, 0, 1738, 0, 1240, 0, 2827, 0, 2553, 0, 1542, 0, 1298, 0, ]
%current = [0, 2436, 0, 1972, 0, 1235, 0, 1723, 0, 2705, 0, 2719, 0, 1752, 0, 1235, 0, 2822, 0, 2563, 0, 1557, 0, 1293, 0, 2167, 0, 2880, 0, 2363, 0, 1396, 0, 2099, 0, 1269, 0, 2622, 0, 2788, 0, 1875, 0, 1230, 0, 1821, 0, 2768, 0, 2656, 0, 1660, 0, 1254, 0, 2861, 0, 2475, 0, 1479, 0, 1337, 0, 2270, 0, 2885, 0, 2270, 0, 1337, 0, 1958, 0, 2856, 0, 2045, 0, 1254, 0, 1660, ]

%free running, increased resolution lower prescaler
%voltage = [2060, 1303, 1220, 2148, 2983, 2470, 2744, 1640, 1518, 2631, 2929, 2998, 2294, 1279, 1459, 2568, 2958, 3002, 1787, 1171, 1914, 2915, 2714, 2885, 1865, 1166, 1835, 2875, 2978, 2519, 1420, 1303, 2348, 2021, 2954, 2587, 1474, 1264, 2783, 2519, 2973, 2104, 1201, 1616, 1367, 2446, 2993, 2177, 1206, 1171, 1787, 2846, 2768, 1674, 1459, 1274, 2788, 2817, 1748, 1166, 1191, 1625, 2734, 2866, 1826, 1577, 1210, 2124, 2978, 2485, 1391, 1650, 1191, 2055, 2963, 2558, 2309, 1284, 1455, 2553];
%current = [1577, 1210, 1586, 2690, 2895, 2998, 2216, 1196, 2075, 2968, 2543, 2797, 1708, 1176, 1997, 2949, 2773, 2841, 1318, 1401, 2495, 2983, 2988, 2446, 1367, 1347, 2421, 2656, 2919, 1943, 1166, 1757, 2832, 2592, 2949, 2021, 1186, 2270, 1938, 2919, 2661, 1547, 1230, 2187, 1865, 2890, 2714, 1606, 1547, 1323, 2377, 2998, 2255, 1259, 1181, 2290, 2998, 2338, 1298, 1513, 1235, 2202, 2993, 2846, 1791, 1166, 2407, 1337, 1372, 1860, 1166, 2866, 1171, 1748, 2822, 1230, 2172, 2993, 2636, 2919];

%free running, 4 prescale
%voltage = [1967, 1528, 1713, 1914, 2128, 2338, 2534, 2695, 2827, 2905, 2929, 2900, 2827, 2705, 2548, 2358, 2221, 2011, 1796, 1601, 1435, 1308, 1220, 1186, 1206, 1279, 1391, 1547, 1733, 1943, 2153, 2363, 2553, 2714, 2836, 2905, 2929, 2895, 2812, 2690, 2529, 2402, 2197, 1982, 1777, 1582, 1420, 1293, 1215, 1186, 1215, 1289, 1406, 1567, 1757, 1967, 2177, 2387, 2573, 2729, 2846, 2910, 2929, 2890, 2802, 2670, 2563, 2382, 2172, 1958, 1752, 1562, 1401, 1284, 1210, 1186, 1220, 1298, 1425, 1586, ]
%current = [2089, 1645, 1845, 2055, 2202, 2402, 2592, 2744, 2856, 2915, 2929, 2880, 2792, 2656, 2485, 2290, 2080, 1865, 1665, 1489, 1342, 1245, 1191, 1191, 1250, 1347, 1489, 1669, 1870, 2011, 2221, 2426, 2607, 2758, 2866, 2919, 2924, 2875, 2778, 2636, 2465, 2265, 2055, 1840, 1645, 1469, 1333, 1235, 1191, 1196, 1259, 1362, 1513, 1694, 1826, 2036, 2250, 2451, 2631, 2773, 2875, 2924, 2919, 2866, 2763, 2617, 2441, 2246, 2031, 1821, 1621, 1450, 1318, 1230, 1186, 1206, 1264, 1376, 1528, 1650, ]

%free running, 8 prescale
%voltage = [1440, 1210, 1313, 1494, 1738, 2011, 2294, 2553, 2753, 2880, 2919, 2871, 2729, 2519, 2260, 1977, 1708, 1469, 1298, 1206, 1201, 1289, 1464, 1694, 1967, 2250, 2514, 2724, 2866, 2924, 2885, 2758, 2558, 2304, 2026, 1752, 1503, 1323, 1215, 1196, 1269, 1425, 1650, 1923, 2202, 2470, 2695, 2851, 2919, 2895, 2783, 2597, 2348, 2070, 1791, 1542, 1342, 1225, 1191, 1254, 1401, 1616, 1875, 2158, 2431, 2661, 2832, 2915, 2905, 2807, 2631, 2392, 2119, 1835, 1577, 1372, 1240, 1191, 1235, 1367, ]
%current = [1523, 1254, 1396, 1611, 1875, 2153, 2426, 2661, 2827, 2915, 2905, 2807, 2631, 2397, 2124, 1840, 1582, 1372, 1240, 1191, 1240, 1367, 1572, 1826, 2109, 2387, 2626, 2807, 2905, 2915, 2832, 2666, 2436, 2167, 1884, 1621, 1406, 1254, 1191, 1220, 1342, 1533, 1782, 2065, 2343, 2592, 2783, 2895, 2919, 2851, 2700, 2475, 2211, 1933, 1665, 1435, 1274, 1196, 1210, 1318, 1503, 1738, 2016, 2294, 2553, 2758, 2885, 2919, 2866, 2729, 2519, 2255, 1977, 1704, 1469, 1293, 1206, 1201, 1293, 0, ]


% voltage = [2407, 3100, 2392, 1557, 913, 766, 1162, 1923, 2749, 3325, 3344, 2836, 2041, 1250, 771, 869, 1455, 2280, 3041, 3413, 3183, 2524, 1684, 991, 747, 1064, 1791, 2631, 3266, 3378, 2944, 2172, 1362, 815, 815, 1342, 2148, 2939, 3393, 3251, 2646, 1816, 1074, 747, 986, 1660, 2504, 3193, 3403, 3037, 2304, 1474, 869, 781, 1230, 2016, 2832, 3359, 3310, 2763, 1948, 1171, 756, 913, 1538, 2373, 3105, 3417, 3125, 2431, 1596, 937, 751, 1132, 1884, 2714, 3310, 3354, 2871, 2080, ]
% current = [2167, 2783, 1972, 1196, 761, 903, 1513, 2348, 3090, 3413, 3139, 2456, 1621, 952, 751, 1113, 1855, 2690, 3300, 3364, 2890, 2109, 1303, 791, 844, 1396, 2216, 2993, 3403, 3217, 2587, 1752, 1030, 742, 1025, 1723, 2568, 3232, 3393, 2993, 2241, 1416, 844, 800, 1284, 2084, 2885, 3378, 3281, 2705, 1884, 1123, 751, 952, 1601, 2436, 3149, 3408, 3081, 2368, 1538, 898, 766, 1181, 1948, 2773, 3334, 3334, 2817, 2016, 1225, 771, 883, 1474, 2309, 3061, 3413, 3164, 2500, 0, ]

voltage = [2065, 1547, 2387, 3120, 3417, 3120, 2426, 1591, 932, 751, 1137, 1899, 2724, 3320, 3359, 2866, 2070, 1269, 781, 859, 1425, 2250, 3022, 3413, 3203, 2553, 1718, 1010, 742, 1044, 1757, 2597, 3251, 3393, 2968, 2207, 1386, 825, 805, 1313, 2114, 2915, 3388, 3271, 2680, 1850, 1098, 742, 966, 1625, 2470, 3173, 3413, 3066, 2338, 1508, 883, 771, 1201, 1977, 2797, 3354, 3325, 2792, 1987, 1201, 761, 898, 1503, 2338, 3085, 3417, 3154, 2470, 1635, 957, 747, 1103, 1845, 2680, ]
current = [2309, 1962, 2783, 3344, 3330, 2812, 2001, 1215, 761, 888, 1484, 2319, 3071, 3417, 3164, 2490, 1650, 971, 747, 1088, 1826, 2666, 3286, 3378, 2919, 2138, 1328, 800, 830, 1367, 2182, 2968, 3403, 3237, 2617, 1782, 1054, 737, 1005, 1694, 2534, 3212, 3403, 3022, 2270, 1450, 854, 786, 1254, 2045, 2851, 3374, 3300, 2734, 1918, 1152, 747, 927, 1562, 2402, 3129, 3417, 3110, 2407, 1567, 917, 756, 1152, 1909, 2739, 3330, 3349, 2851, 2055, 1259, 776, 864, 1440, 2270, 0, ]
RMSVoltage = [ 2271.000000 ]
RMSCurrent = [ 2259.000000 ]
VoltageLA = [1806, 1967, 2753, 3268, 3268, 2773, 2008, 1261, 841, 944, 1518, 2311, 3022, 3339, 3112, 2468, 1669, 1025, 820, 1142, 1837, 2636, 3217, 3308, 2878, 2135, 1364, 876, 893, 1400, 2177, 2924, 3322, 3180, 2587, 1796, 1105, 815, 1059, 1713, 2514, 3151, 3329, 2975, 2265, 1474, 920, 854, 1295, 2047, 2821, 3293, 3239, 2702, 1923, 1195, 827, 986, 1589, 2387, 3075, 3339, 3058, 2389, 1594, 981, 829, 1200, 1920, 2711, 3251, 3285, 2812, 2052, 1296, 852, 925, 1474, 2262, 3393, ]
CurrentLA = [1154, 2135, 2372, 3063, 3337, 3071, 2406, 1608, 988, 824, 1186, 1901, 2695, 3244, 3290, 2827, 2070, 1310, 859, 917, 1457, 2246, 2976, 3332, 3148, 2528, 1733, 1064, 815, 1098, 1774, 2575, 3185, 3320, 2927, 2199, 1418, 895, 871, 1349, 2114, 2873, 3307, 3212, 2646, 1860, 1152, 820, 1020, 1649, 2448, 3112, 3337, 3017, 2326, 1535, 949, 837, 1244, 1982, 2765, 3273, 3263, 2758, 1987, 1242, 836, 954, 1530, 2324, 3034, 3339, 3100, 2453, 1657, 1017, 820, 1152, 1855, 1135, ]
Power  = [2.08, 4.20, 6.53, 10.01, 10.91, 8.52, 4.83, 2.03, 0.83, 0.78, 1.80, 4.39, 8.14, 10.83, 10.24, 6.98, 3.45, 1.34, 0.70, 1.05, 2.68, 5.92, 9.57, 11.02, 9.06, 5.40, 2.36, 0.93, 0.73, 1.54, 3.86, 7.53, 10.58, 10.56, 7.57, 3.95, 1.57, 0.73, 0.92, 2.31, 5.31, 9.05, 11.01, 9.56, 5.99, 2.74, 1.06, 0.70, 1.32, 3.38, 6.91, 10.25, 10.81, 8.15, 4.47, 1.83, 0.78, 0.83, 1.98, 4.73, 8.50, 10.93, 9.98, 6.59, 3.17, 1.22, 0.69, 1.14, 2.94, 6.30, 9.86, 10.97, 8.72, 5.03, 2.15, 0.87, 0.76, 1.70, 4.20, 3.85, ]
RMSPower = [ 5028 ]



time = 1:length(voltage);
time2 = 1:length(voltage)*2;
voltage2 = Proper_Implementation_V(voltage);
current2 = Proper_Implementation_V(current);

j = 1;

for i = 1:length(VoltageLA)
    superBigArrayV(j) = voltage(i);
    j = j + 1;
    superBigArrayV(j) = VoltageLA(i);
    j = j + 1;
end

j = 1;
for i = 1:length(CurrentLA)
    superBigArrayC(j) = CurrentLA(i);
    j = j + 1;
    superBigArrayC(j) = current(i);
    j = j + 1;
end


tiledlayout(4,1)

% nexttile
% plot(time, voltage, 'ro', time, voltage2, 'go')
% title('voltage.real')


nexttile
plot(time2, superBigArrayV, 'go')
title('voltage_guess')


nexttile
plot(time, current, 'ro', time, CurrentLA, 'go')
title('current.real')


nexttile
plot(time2, superBigArrayC, 'go')
title('current_guess')

% nexttile
% plot(time, current,'bo')
% title('current')
% 
% current2 = Algo2(current);
% nexttile
% plot(time2, current2,'bo')
% title('current_guess')
% 
% power = voltage2 .* current2;
% nexttile
% plot(time2, power, 'bo')
% title("power guess")
